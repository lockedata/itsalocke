<!DOCTYPE html>
<html lang="en-gb">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Helping people get started with data science">
  <meta name="author" content="Locke Data">
  <meta name="generator" content="Hugo 0.25.1" />
  <title>Building an R training environment &middot; Locke Data</title>
  <!-- Stylesheets -->
  <link href="http://lockelife.com/css/bootstrap-v3.3.7/bootstrap.min.css" rel="stylesheet">
  <link href="http://lockelife.com/css/lockedata.css" rel="stylesheet">
  <link href="http://lockelife.com/css/jquery.form-validator-v2.3.44/theme-default.min.css" rel="stylesheet">

  

  <!-- Custom Fonts -->
  <link href="http://lockelife.com/font-awesome-v4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


  
    <link rel="shortcut icon" type="image/x-icon" href="http://lockelife.com/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://lockelife.com/favicon.ico">
  


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <!--[if lt IE 9]>


  <![endif]-->
</head>


  <body id="page-top" class="single">
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">

    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand page-scroll" href="/#page-top">
          
          <img src="http://lockelife.com/img/LockeDataTextNew.svg" class="img-responsive" alt="">
        </a>
      

    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li class="hidden">
          <a href="/#page-top"></a>
        </li>
        

        
          <li>
            <a href="/#casestudies">Case Studies</a>
          </li>
        
          <li>
            <a href="/#community">Community</a>
          </li>
        
          <li>
            <a href="/#calendar">Calendar</a>
          </li>
        
          <li>
            <a href="/#contact">Contact</a>
          </li>
        
          <li>
            <a href="/#company">Company</a>
          </li>
        
        
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container-fluid -->
</nav>

    <!-- Single -->
<header>
  <div class="container">
    <div class="intro-text">
      <div class="intro-heading">Building an R training environment</div>
      <div class="intro-lead-in"></div>
    </div>
  </div>
</header>
<section id="single">
  <div class="container">
    
      

<p>I recently delivered a day of training at <a href="http://sqlbits.com">SQLBits</a> and I really upped my game in terms of infrastructure for it. The resultant solution was super smooth and mitigated all the install issues and preparation for attendees. This meant we got to spend the whole day doing R, instead of troubleshooting.</p>

<p>I&#8217;m so happy with the solution for an online R training environment that I want to share the solution, so you can take it and use it for when you need to do training.</p>

<h2 id="tl-dr-figure-id-attachment-62106-style-width-750px-class-wp-caption-aligncenter">TL;DR<figure id="attachment_62106" style="width: 750px" class="wp-caption aligncenter"></h2>

<p><img src="http://res.cloudinary.com/lockedata/image/upload/h_500,w_750/v1499849764/Workflow_cat6ai.jpg" alt="Workflow for constructing a training environment with RStudio" width="750" height="500" class="size-large wp-image-62106" /><figcaption class="wp-caption-text">Workflow for constructing a training environment with RStudio</figcaption></figure></p>

<p>To get a web-facing Rstudio server, with login details for users, and all the prerequisites installed:</p>

<ol>
<li>Generate usernames and passwords</li>
<li>Build a Docker image based on rocker that contains your users and any prerequisites</li>
<li>Run docker image on VM with a port binding to make the Rstudio accessible externally</li>
</ol>

<h2 id="where-the-magick-happens">Where the <code>magick</code> happens</h2>

<p>The first thing I wanted was user names and passwords for people. I wanted these preprepared and, ideally, on something with my contact info. I&#8217;d used <a href="https://www.moo.com/">moo</a> before so I knew I could do up to 100 custom cards &#8211; I just needed to make them. I used the package <a href="https://cran.r-project.org/package=random"><code>random</code></a> and the package <a href="https://cran.r-project.org/package=magick"><code>magick</code></a> to generate credentials and write them on to PDFs that could then be uploaded to moo.</p>

<p>You can read the whole <a href="https://gist.github.com/stephlocke/32185d02371f29a9ae897aadd28fc1f9">gist</a> but the key code includes:</p>

<ul>
<li><p>A random password generation step</p>

<p>write.csv(data.frame(usernames=paste0(&ldquo;u&rdquo;,stringr::str_pad(1:n,pad = &ldquo;0&rdquo;,width = 3))
                     ,pwords=random::randomStrings(n,len = 6,digits = FALSE,loweralpha = FALSE))
          ,&ldquo;users100.csv&rdquo;,row.names = FALSE)</p></li>

<li><p>A read of my blank card back</p></li>
</ul>

<pre><code class="r">myimage &lt;- magick::image_read(myfile,density = 500)
</code></pre>

<ul>
<li><p>In a loop (there&#8217;s probably a better way!)</p>

<ul>
<li>Writing out the text to the card back</li>
<li>Save a new card back</li>
</ul>

<p>myimage2 &lt;- magick::image_annotate(  myimage, &ldquo;lockedata.biz&rdquo;, font = &ldquo;Roboto&rdquo;, size = 90, location = &ldquo;+350+75&rdquo; )
magick::image_write(myimage2, paste0(&ldquo;GeneratedBacks/&rdquo;,basename, up[i,&ldquo;usernames&rdquo;], &ldquo;.&rdquo;, baseext))</p></li>
</ul>

<h2 id="making-users">Making users</h2>

<p>The next, and much more tricksy, bit was writing a script that would correctly create users. <a href="https://twitter.com/shawty_ds">Peter Shaw</a> helped me out initially and the code looks like:</p>

<pre><code>for userdetails in `cat users.csv`
do
        user=`echo $userdetails | cut -f 1 -d ,`
    passwd=`echo $userdetails | cut -f 2 -d ,`
        useradd $user -m -p `mkpasswd $passwd`
done
</code></pre>

<p>This goes through each line in the CSV and adds a user with a specified password. We use the <code>mkpasswd</code> utility here to encrypt the password. <code>mkpasswd</code> is part of the <code>whois</code> program and we&#8217;ll need that tidbit later.</p>

<p>This needs to be done not only to give people login info but a home directory to save their stuff into. If they don&#8217;t have home directories then Rstudio throws a tantrum with them.</p>

<h2 id="rocker">rocker</h2>

<p>The next bit was getting some sort of server with Rstudio installed. <a href="https://github.com/eddelbuettel">Dirk Eddelbuettel</a> made a bunch of Docker containers available under the <a href="https://github.com/rocker-org/"><code>rocker</code></a> brand. One of these has <a href="https://www.rstudio.com/products/rstudio/download-server/">Rstudio server</a> and the [<code>tidyverse</code>]() installed. Using this preconfigured container would mean I&#8217;d only have to add my finishing touches to it to get everything I needed.</p>

<h2 id="dockerfile">Dockerfile</h2>

<p>The last but one step was building my own customised Docker container that used rocker as a base, created all my users, and installed anything extra I wanted on top of the tidyverse.</p>

<pre><code>FROM rocker/tidyverse
MAINTAINER Steph Locke &lt;steph@itsalocke.com&gt;
RUN apt-get install libudunits2-0 libudunits2-dev whois
RUN  R -e 'devtools::install_github(&quot;lockedata/TextAnalysis&quot;)' 
RUN  R -e 'devtools::install_github(&quot;dgrtwo/widyr&quot;)' 
ADD https://gist.githubusercontent.com/stephlocke/0036331e7a3338e965149833e92c1360/raw/607fb01602e143671c83216a4c5f1ad2deb10bf6/mkusers.sh /
ADD https://gist.githubusercontent.com/stephlocke/0036331e7a3338e965149833e92c1360/raw/6d967c19d9c73cecd1e2d4da0eed2cd646790bd5/users.csv /
RUN chmod 777 /mkusers.sh
RUN /mkusers.sh
</code></pre>

<p>This starts with the tidyverse &amp; Rstudio then:</p>

<ul>
<li>adds the requisite programs for dependencies in my package and <code>whois</code> for <code>mkpasswd</code> to be able to work</li>
<li>installs packages from github, notably the one designed to facilitate the day of text analysis</li>
<li>get the shell script and the csv from the gist</li>
<li>make the shell script executable and then run it</li>
</ul>

<h2 id="c-8217-est-fini">C&#8217;est fini!</h2>

<p>The final step was to actually this container on a Digital Ocean virtual machine (but it could be run anywhere) like so:</p>

<pre><code class="bash">docker pull stephlocke/montypythonwkrshopdocker 
docker run -d -p 80:8787 stephlocke/montypythonwkrshopdocker
</code></pre>

<p>You can take my <a href="https://github.com/stephlocke/montypythonwkrshopdocker">github repo</a> with the Dockerfile and customise it to suit your own requirements, build it in Docker and then use it whenever you need an R training environment that can be customised to your needs and is accessible from a web browser.</p>

<p>You can use it for general working environments but make sure to read my <a href="https://itsalocke.com/talking-data-and-docker/">data persistence in Docker</a> post first as the <code>run</code> command does not have an external volume mapped and if your host for docker crashes, everything will be lost permanently. An extra incentive to use source control maybe!</p>

    
  </div>
</section>


    
    

    

    

    <!-- jQuery -->
<script src='js/jquery-v3.2.1/jquery.min.js'></script>

<!-- Bootstrap Core -->
<script src="http://lockelife.com/js/bootstrap-v3.3.7/bootstrap.min.js"></script>



<!-- Custom Theme -->
<script src="http://lockelife.com/js/agency.js"></script>






  
 <!-- calendar -->
 <script src='js/moment-v2.18.1/moment.min.js'></script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>
  <link href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.css" rel="stylesheet" type="text/css">
  <link href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.print.css" rel="stylesheet" type="text/css" media='print'>
<script src='js/moment-v2.18.1/moment.min.js'></script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/gcal.min.js"></script>
  <link href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.css" rel="stylesheet" type="text/css">
  <link href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.print.css" rel="stylesheet" type="text/css" media='print'>
<script>

	$(document).ready(function() {
	
		$('#calendarobj').fullCalendar({

			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,listYear'
			},

			displayEventTime: false, 

        googleCalendarApiKey: 'AIzaSyATQH8hB-JTno5Snw11GZ4uZVNVxbaiIIc',
        events: {
            googleCalendarId: 'n58bvqjr8a5ur8jgb2o712mn4k@group.calendar.google.com'
        },
			editable: false,
			eventClick: function(event) {
				
				window.open(event.url, 'gcalevent', 'width=700,height=600');
				return false;
			},
			
			loading: function(bool) {
				$('#loading').toggle(bool);
			}
			
		});
		
	});

</script>


  </body>
</html>
